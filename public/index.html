<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>LazyFill</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="viewport">
    <div id="brushGuide"></div>
    <div id="canvasContainer" style="position: absolute; top: 0; left: 0; transform-origin: 0 0;">
      <canvas id="canvasInput" style="display: block;"></canvas>
      <canvas id="canvasMarker" style="position: absolute; top: 0; left: 0; cursor: crosshair;"></canvas>
      <canvas id="canvasOutput"
        style="position: absolute; top: 0; left: 0; visibility: hidden; pointer-events: none;"></canvas>
    </div>

    <div id="drop-message">
      <div>📂 ここに画像をドロップ</div>
      <div style="font-size: 1rem; margin-top: 10px;">(もしくはクリップボードからペースト)</div>
    </div>
  </div>

  <div id="panel-top" class="panel">
    <h1>LazyFill</h1>

    <div
      style="display: flex; align-items: center; margin-right: 15px; background: rgba(0,0,0,0.05); padding: 5px 10px; border-radius: 4px;">
      <span style="margin-right: 5px; font-size: 0.9rem;">🔎</span>
      <input type="number" id="inpZoomLevel" value="100" step="10" min="1" max="10000"
        style="width: 50px; text-align: right; border: 1px solid #ccc; border-radius: 4px; padding: 4px;">
      <span style="margin-left: 3px; font-size: 0.9rem;">%</span>
    </div>

    <button id="btnRun" class="btn-primary">▶ 塗りつぶし実行</button>

    <label style="margin: 0 10px; cursor: pointer; user-select: none;">
      <input type="checkbox" id="chkDynamic" checked>
      <span style="margin-left: 5px;">自動更新</span>
    </label>
    
    <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px; margin-left: 10px;">
      <div style="display: flex; gap: 5px;">
        <button id="btnDownloadImg" class="btn-secondary" disabled>⇩ 画像保存</button>
        <label style="margin: 0 10px; cursor: pointer; user-select: none;">
          <input type="checkbox" id="chkTransparent" checked> 背景透過
        </label>
        <button id="btnDownloadMask" class="btn-secondary" disabled>⇩ マスク保存</button>
      </div>
    </div>

    <div style="width: 1px; height: 30px; background: #ddd; margin: 0 10px;"></div>

    <button id="btnToggleParams" class="btn-secondary">⚙️ 詳細設定</button>
  </div>

  <div id="panel-params" class="panel hidden">
    <h3>
      詳細設定
      <button class="panel-toggle-btn"
        onclick="document.getElementById('panel-params').classList.add('hidden')">×</button>
    </h3>

    <div class="row">
      <span>BB Threshold</span>
      <input type="number" id="inpBB" value="0.2" step="0.1">
    </div>
    <div class="row">
      <span>Padding (px)</span>
      <input type="number" id="inpPadding" value="1" step="1" min="0">
    </div>
    <div class="row">
      <span>Sigma</span>
      <input type="number" id="inpSigma" value="0.3" step="0.01">
    </div>
    <div class="row">
      <span>Max Iter</span>
      <input type="number" id="inpMaxIter" value="5000" step="100">
    </div>
    <div class="row">
      <span>BFS Num</span>
      <input type="number" id="inpBfsNum" value="10" step="1">
    </div>
    <div class="row">
      <span>Strength</span>
      <input type="number" id="inpStrength" value="0.95" step="0.05">
    </div>
  </div>

  <div id="panel-tools" class="panel">
    <h3>ツール & パレット</h3>

    <div style="margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
      <label style="margin: 0; cursor: pointer; user-select: none; font-weight: bold;">
        <input type="checkbox" id="chkShowMarker">
        マーカー表示
      </label>
    </div>

    <div class="tool-group">
      <label class="tool-btn-label">
        <input type="radio" name="toolMode" value="brush" checked> 🖌 ブラシ
      </label>
      <label class="tool-btn-label">
        <input type="radio" name="toolMode" value="eraser"> 🧹 消しゴム
      </label>
      <label class="tool-btn-label">
        <input type="radio" name="toolMode" value="move"> ✋ デフォルト
      </label>
    </div>

    <div style="margin: 0 0 15px 0;">
      <div class="row">
        <span>ブラシサイズ: <strong id="dispBrushSize">2</strong>px</span>
      </div>
      <input type="range" id="inpBrushSize" min="1" max="50" value="2">
    </div>

    <div class="color-row">
      <input type="color" id="colorPicker" value="#0000ff">
      <div style="display: flex; flex-direction: column; flex: 1;">
        <span id="currentLabelName" style="font-weight: bold; font-size: 1.1rem;">色2</span>
        <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
          <span style="font-size: 0.9rem;">透明度:</span>
          <input type="number" id="alphaInput" value="1.0" step="0.1" min="0.1" max="1.0" style="width: 60px;">
        </div>
      </div>
    </div>

    <div id="paletteContainer">
    </div>

    <div style="display: flex; gap: 10px; margin-top: 10px;">
      <button id="btnAddLabel" class="btn-large-action" style="flex: 2;">+ 追加</button>
      <button id="btnDeleteLabel" class="btn-large-action" style="flex: 1;" disabled>- 削除</button>
    </div>
    <button id="btnClearMarkers" class="btn-large-action" style="margin-top: 10px;">🗑 マーカーをクリア</button>
  </div>

  <script type="module">
    import { main } from "./main.js";
    main();
  </script>
</body>
</html>